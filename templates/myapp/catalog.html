{% extends 'myapp/base.html' %}

{% block libreria_el_poeta %}
<!-- Contenido opcional aquí -->
{% endblock %}

{% block descripcion %}
<!-- Contenido opcional aquí -->
{% endblock %}

{% block content %}
<div class="my-40 w-full" id="product">
    <h1 class="text-white font-bold text-center text-8xl mt-40" style="font-family: 'Dancing Script'">Catálogo</h1>
    
    <!-- Elemento para verificar autenticación -->
    {% if user.is_authenticated %}
    <div id="is-authenticated" style="display: none;"></div>
    {% endif %}
    
    <section class="mt-[300px] flex flex-row flex-wrap justify-center sticky">
        {% for producto in productos %}
        <div id="card" class="cursor-pointer card mx-10 bg-white w-[450px] h-auto flex-col border border-black shadow-lg hover:shadow-xl shadow-white mx-26 my-16 rounded-xl pb-2" onclick="showProductDetails('{{ producto.nombre }}', '{{ producto.fotoLink }}', '{{ producto.descripcion }}', '{{ producto.precio_venta }}', '{{ producto.precio_arriendo }}', '{{ producto.editorial }}', '{{ producto.bodega }}', '{{ producto.cantidad_en_stock }}')">
            <h2 class="text-2xl text-center font-bold text-gray-800 mt-3">{{ producto.nombre }}</h2>
            <hr class="border border-gray mr-2 my-2">

            <div class="flex">
                <div class="flex flex-col">
                    <img src="{{ producto.fotoLink }}" class="card-img-top h-60 rounded-xl my-auto mx-2" alt="{{ producto.nombre }}">
                    <h3 class="font-bold mx-2">Autor(es): </h3>
                    {% for autor in producto.autores.all %}
                    <p class="bold mx-2"> {{ autor.nombre }}</p> 
                    {% endfor %}
                    <hr class="border border-gray mr-2 my-2">
                    <p class="font-bold mx-2">Editorial:</p>
                    <p class="mx-2">{{ producto.editorial }}</p>
                </div>
                <div class="card-body">
                    <p class="font-bold">Precio: </p>
                    <p>Venta ${{ producto.precio_venta }}</p>
                    <p>Arriendo ${{ producto.precio_arriendo }}</p>
                    <hr class="border border-gray mr-2 my-2">
                    <p class="font-bold">Bodega: </p>
                    <p>{{ producto.bodega }}</p>
                    <hr class="border border-gray mr-2 my-2">
                    <p class="font-bold">Stock: </p>
                    <p id="stock-{{ producto.id }}">{{ producto.cantidad_en_stock }}</p> <!-- Aquí se asegura el identificador único -->
                    <hr class="border border-gray mr-2 my-2">
                    <div class="flex flex-col my-8">
                        <button class="bg-green-500 p-1 rounded shadow shadow-black hover:bg-green-600 hover:shadow-lg" onclick="event.stopPropagation(); openModal('comprar', '{{ producto.nombre }}', {{ producto.precio_venta }}, {{ producto.id }})">Añadir Compra</button>
                        <button class="mt-2 bg-blue-500 p-1 rounded shadow shadow-black hover:bg-blue-600 hover:shadow-lg" onclick="event.stopPropagation(); openModal('arrendar', '{{ producto.nombre }}', {{ producto.precio_arriendo }}, {{ producto.id }})">Añadir Arriendo</button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

    </section>
</div>

<!-- Modal para confirmación de acciones -->
<div id="modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-8 rounded-lg shadow-lg w-1/3">
        <h2 class="text-2xl font-bold mb-4" id="modal-title"></h2>
        <p class="mb-6" id="modal-message"></p>
        <div class="flex justify-end space-x-4">
            <button class="bg-red-500 p-2 rounded shadow hover:bg-red-600" onclick="closeModal()">Cancelar</button>
            <button class="bg-green-500 p-2 rounded shadow hover:bg-green-600" onclick="confirmAction()">Confirmar</button>
        </div>
    </div>
</div>

<!-- Modal de descripción del producto -->
<div id="product-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-3xl h-auto max-h-full overflow-auto">
        <h2 class="text-2xl font-bold mb-4" id="product-modal-title"></h2>
        <img id="product-modal-image" src="" alt="Imagen del producto" class="w-64 h-64 mb-4 mx-auto">
        <p id="product-modal-description" class="mb-4"></p>
        <p><strong>Precio Venta:</strong> $<span id="product-modal-price-venta"></span></p>
        <p><strong>Precio Arriendo:</strong> $<span id="product-modal-price-arriendo"></span></p>
        <p><strong>Editorial:</strong> <span id="product-modal-editorial"></span></p>
        <p><strong>Bodega:</strong> <span id="product-modal-bodega"></span></p>
        <p><strong>Stock:</strong> <span id="product-modal-stock"></span></p>
        <div class="flex justify-end space-x-4 mt-4">
            <button class="bg-red-500 p-2 rounded shadow hover:bg-red-600" onclick="closeProductModal()">Cerrar</button>
        </div>
    </div>
</div>
<script>
    // JavaScript para manejar la autenticación antes de abrir el modal de compra o arriendo
    function openModal(action, productName, price, productId) {
        // Verificar si el usuario está autenticado
        if (!document.getElementById('is-authenticated')) {
            alert('Debes iniciar sesión para realizar esta acción, dirigete al ícono de usuario.');
            return;
        }

        // Código para manejar la apertura del modal
        const modal = document.getElementById('modal');
        const title = document.getElementById('modal-title');
        const message = document.getElementById('modal-message');
        
        modal.dataset.action = action;
        modal.dataset.productName = productName;
        modal.dataset.price = price;
        modal.dataset.productId = productId;
        
        if (action === 'comprar') {
            title.innerText = 'Confirmar Compra';
            message.innerText = `¿Estás seguro de que deseas añadir el producto "${productName}" a tu carrito?`;
        } else if (action === 'arrendar') {
            title.innerText = 'Confirmar Arriendo';
            message.innerText = `¿Estás seguro de que deseas añadir el producto "${productName}" a tu carrito?`;
        }
        
        modal.classList.remove('hidden');
    }

    function closeModal() {
        const modal = document.getElementById('modal');
        modal.classList.add('hidden');
    }
</script>

{% endblock %}
